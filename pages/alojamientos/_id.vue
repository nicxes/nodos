<template>
  <section class="pb-12">
    <div class="mb-4 md:container md:mx-auto md:max-w-[800px]">
      <client-only>
        <div ref="swiperImages" class="swiper">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
              <img :src="data.attributes.objeto.attributes.image_url" class="md:rounded-b-3xl" />
            </div>
          </div>
        </div>
      </client-only>
    </div>

    <div class="container mx-auto max-w-[800px]">
      <div>
        <h1 class="mb-5 text-xl font-bold md:px-4">
          {{ data.attributes.objeto.attributes.name }}
        </h1>
        <h2 v-if="alojamiento && alojamiento.attributes.street_address" class="text-[#919191] mb-5 md:px-4">
          {{ alojamiento.attributes.street_address }}
        </h2>

        <div class="bg-[#F7F7F7] p-4 mb-5">
          <h3 class="text-xl font-bold mb-3">
            ¿Qué ofrece?
          </h3>
          <p>
            {{ data.attributes.objeto.attributes.description }}
          </p>
        </div>

        <div class="hidden bg-[#F7F7F7] p-4 mb-5">
          <h3 class="text-xl font-bold mb-3">
            Condiciones
          </h3>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam quis tempor nulla. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.
          </p>
        </div>

        <div v-if="alojamiento && alojamiento.attributes.checkin_time && alojamiento.attributes.checkout_time" class="bg-[#F7F7F7] p-4 mb-5">
          <h3 class="text-xl font-bold mb-3">
            Horarios
          </h3>
          <ul>
            <li class="flex items-center mb-2">
              <div class="mr-1">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.8337 10.1462L12.7087 12.0212C12.8614 12.1739 12.9378 12.365 12.9378 12.5945C12.9378 12.8234 12.8614 13.0212 12.7087 13.1878C12.542 13.3545 12.3442 13.4378 12.1153 13.4378C11.8859 13.4378 11.6878 13.3545 11.5212 13.1878L9.75033 11.417C9.55588 11.2225 9.41005 11.0073 9.31283 10.7712C9.2156 10.535 9.16699 10.2781 9.16699 10.0003V7.50033C9.16699 7.26421 9.24699 7.06616 9.40699 6.90616C9.56644 6.74671 9.76421 6.66699 10.0003 6.66699C10.2364 6.66699 10.4345 6.74671 10.5945 6.90616C10.7539 7.06616 10.8337 7.26421 10.8337 7.50033V10.1462ZM10.0003 3.33366C10.2364 3.33366 10.4345 3.41338 10.5945 3.57283C10.7539 3.73283 10.8337 3.93088 10.8337 4.16699C10.8337 4.4031 10.7539 4.60116 10.5945 4.76116C10.4345 4.9206 10.2364 5.00033 10.0003 5.00033C9.76421 5.00033 9.56644 4.9206 9.40699 4.76116C9.24699 4.60116 9.16699 4.4031 9.16699 4.16699C9.16699 3.93088 9.24699 3.73283 9.40699 3.57283C9.56644 3.41338 9.76421 3.33366 10.0003 3.33366ZM16.667 10.0003C16.667 10.2364 16.587 10.4342 16.427 10.5937C16.2675 10.7537 16.0698 10.8337 15.8337 10.8337C15.5975 10.8337 15.3998 10.7537 15.2403 10.5937C15.0803 10.4342 15.0003 10.2364 15.0003 10.0003C15.0003 9.76421 15.0803 9.56616 15.2403 9.40616C15.3998 9.24671 15.5975 9.16699 15.8337 9.16699C16.0698 9.16699 16.2675 9.24671 16.427 9.40616C16.587 9.56616 16.667 9.76421 16.667 10.0003ZM10.0003 15.0003C10.2364 15.0003 10.4345 15.0803 10.5945 15.2403C10.7539 15.3998 10.8337 15.5975 10.8337 15.8337C10.8337 16.0698 10.7539 16.2675 10.5945 16.427C10.4345 16.587 10.2364 16.667 10.0003 16.667C9.76421 16.667 9.56644 16.587 9.40699 16.427C9.24699 16.2675 9.16699 16.0698 9.16699 15.8337C9.16699 15.5975 9.24699 15.3998 9.40699 15.2403C9.56644 15.0803 9.76421 15.0003 10.0003 15.0003ZM5.00033 10.0003C5.00033 10.2364 4.9206 10.4342 4.76116 10.5937C4.60116 10.7537 4.4031 10.8337 4.16699 10.8337C3.93088 10.8337 3.73283 10.7537 3.57283 10.5937C3.41338 10.4342 3.33366 10.2364 3.33366 10.0003C3.33366 9.76421 3.41338 9.56616 3.57283 9.40616C3.73283 9.24671 3.93088 9.16699 4.16699 9.16699C4.4031 9.16699 4.60116 9.24671 4.76116 9.40616C4.9206 9.56616 5.00033 9.76421 5.00033 10.0003ZM10.0003 18.3337C8.84755 18.3337 7.76421 18.1148 6.75033 17.677C5.73644 17.2398 4.85449 16.6462 4.10449 15.8962C3.35449 15.1462 2.76088 14.2642 2.32366 13.2503C1.88588 12.2364 1.66699 11.1531 1.66699 10.0003C1.66699 8.84755 1.88588 7.76421 2.32366 6.75033C2.76088 5.73644 3.35449 4.85449 4.10449 4.10449C4.85449 3.35449 5.73644 2.7606 6.75033 2.32283C7.76421 1.8856 8.84755 1.66699 10.0003 1.66699C11.1531 1.66699 12.2364 1.8856 13.2503 2.32283C14.2642 2.7606 15.1462 3.35449 15.8962 4.10449C16.6462 4.85449 17.2398 5.73644 17.677 6.75033C18.1148 7.76421 18.3337 8.84755 18.3337 10.0003C18.3337 11.1531 18.1148 12.2364 17.677 13.2503C17.2398 14.2642 16.6462 15.1462 15.8962 15.8962C15.1462 16.6462 14.2642 17.2398 13.2503 17.677C12.2364 18.1148 11.1531 18.3337 10.0003 18.3337ZM10.0003 16.667C11.8614 16.667 13.4378 16.0212 14.7295 14.7295C16.0212 13.4378 16.667 11.8614 16.667 10.0003C16.667 8.13921 16.0212 6.56283 14.7295 5.27116C13.4378 3.97949 11.8614 3.33366 10.0003 3.33366C8.13921 3.33366 6.56283 3.97949 5.27116 5.27116C3.97949 6.56283 3.33366 8.13921 3.33366 10.0003C3.33366 11.8614 3.97949 13.4378 5.27116 14.7295C6.56283 16.0212 8.13921 16.667 10.0003 16.667Z" fill="#B7B9C1"/>
                </svg>
              </div>
              Check-In: <b class="ml-1">Desde las {{ alojamiento.attributes.checkin_time.slice(0, -3) }} hs.</b>
            </li>
            <li class="flex items-center">
              <div class="mr-1">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.8337 10.1462L12.7087 12.0212C12.8614 12.1739 12.9378 12.365 12.9378 12.5945C12.9378 12.8234 12.8614 13.0212 12.7087 13.1878C12.542 13.3545 12.3442 13.4378 12.1153 13.4378C11.8859 13.4378 11.6878 13.3545 11.5212 13.1878L9.75033 11.417C9.55588 11.2225 9.41005 11.0073 9.31283 10.7712C9.2156 10.535 9.16699 10.2781 9.16699 10.0003V7.50033C9.16699 7.26421 9.24699 7.06616 9.40699 6.90616C9.56644 6.74671 9.76421 6.66699 10.0003 6.66699C10.2364 6.66699 10.4345 6.74671 10.5945 6.90616C10.7539 7.06616 10.8337 7.26421 10.8337 7.50033V10.1462ZM10.0003 3.33366C10.2364 3.33366 10.4345 3.41338 10.5945 3.57283C10.7539 3.73283 10.8337 3.93088 10.8337 4.16699C10.8337 4.4031 10.7539 4.60116 10.5945 4.76116C10.4345 4.9206 10.2364 5.00033 10.0003 5.00033C9.76421 5.00033 9.56644 4.9206 9.40699 4.76116C9.24699 4.60116 9.16699 4.4031 9.16699 4.16699C9.16699 3.93088 9.24699 3.73283 9.40699 3.57283C9.56644 3.41338 9.76421 3.33366 10.0003 3.33366ZM16.667 10.0003C16.667 10.2364 16.587 10.4342 16.427 10.5937C16.2675 10.7537 16.0698 10.8337 15.8337 10.8337C15.5975 10.8337 15.3998 10.7537 15.2403 10.5937C15.0803 10.4342 15.0003 10.2364 15.0003 10.0003C15.0003 9.76421 15.0803 9.56616 15.2403 9.40616C15.3998 9.24671 15.5975 9.16699 15.8337 9.16699C16.0698 9.16699 16.2675 9.24671 16.427 9.40616C16.587 9.56616 16.667 9.76421 16.667 10.0003ZM10.0003 15.0003C10.2364 15.0003 10.4345 15.0803 10.5945 15.2403C10.7539 15.3998 10.8337 15.5975 10.8337 15.8337C10.8337 16.0698 10.7539 16.2675 10.5945 16.427C10.4345 16.587 10.2364 16.667 10.0003 16.667C9.76421 16.667 9.56644 16.587 9.40699 16.427C9.24699 16.2675 9.16699 16.0698 9.16699 15.8337C9.16699 15.5975 9.24699 15.3998 9.40699 15.2403C9.56644 15.0803 9.76421 15.0003 10.0003 15.0003ZM5.00033 10.0003C5.00033 10.2364 4.9206 10.4342 4.76116 10.5937C4.60116 10.7537 4.4031 10.8337 4.16699 10.8337C3.93088 10.8337 3.73283 10.7537 3.57283 10.5937C3.41338 10.4342 3.33366 10.2364 3.33366 10.0003C3.33366 9.76421 3.41338 9.56616 3.57283 9.40616C3.73283 9.24671 3.93088 9.16699 4.16699 9.16699C4.4031 9.16699 4.60116 9.24671 4.76116 9.40616C4.9206 9.56616 5.00033 9.76421 5.00033 10.0003ZM10.0003 18.3337C8.84755 18.3337 7.76421 18.1148 6.75033 17.677C5.73644 17.2398 4.85449 16.6462 4.10449 15.8962C3.35449 15.1462 2.76088 14.2642 2.32366 13.2503C1.88588 12.2364 1.66699 11.1531 1.66699 10.0003C1.66699 8.84755 1.88588 7.76421 2.32366 6.75033C2.76088 5.73644 3.35449 4.85449 4.10449 4.10449C4.85449 3.35449 5.73644 2.7606 6.75033 2.32283C7.76421 1.8856 8.84755 1.66699 10.0003 1.66699C11.1531 1.66699 12.2364 1.8856 13.2503 2.32283C14.2642 2.7606 15.1462 3.35449 15.8962 4.10449C16.6462 4.85449 17.2398 5.73644 17.677 6.75033C18.1148 7.76421 18.3337 8.84755 18.3337 10.0003C18.3337 11.1531 18.1148 12.2364 17.677 13.2503C17.2398 14.2642 16.6462 15.1462 15.8962 15.8962C15.1462 16.6462 14.2642 17.2398 13.2503 17.677C12.2364 18.1148 11.1531 18.3337 10.0003 18.3337ZM10.0003 16.667C11.8614 16.667 13.4378 16.0212 14.7295 14.7295C16.0212 13.4378 16.667 11.8614 16.667 10.0003C16.667 8.13921 16.0212 6.56283 14.7295 5.27116C13.4378 3.97949 11.8614 3.33366 10.0003 3.33366C8.13921 3.33366 6.56283 3.97949 5.27116 5.27116C3.97949 6.56283 3.33366 8.13921 3.33366 10.0003C3.33366 11.8614 3.97949 13.4378 5.27116 14.7295C6.56283 16.0212 8.13921 16.667 10.0003 16.667Z" fill="#B7B9C1"/>
                </svg>
              </div>
              Check-Out: <b class="ml-1">Hasta las {{ alojamiento.attributes.checkout_time.slice(0, -3) }} hs.</b>
            </li>
          </ul>
        </div>

        <h3 class="text-[#226B2F] font-bold text-2xl ml-4 mb-5">
          Opciones disponibles
        </h3>

        <client-only>
          <div ref="swiper" class="swiper">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <article class="bg-[#F7F7F7] p-4 h-full flex flex-col justify-between rounded-[10px]">
                  <div>
                    <h4 class="text-xl font-bold mb-3">
                      {{ data.attributes.name }}
                    </h4>
                    <p class="text-sm mb-5 min-h-[70px]">
                      {{ data.attributes.description }}
                    </p>
                  </div>

                  <div class="grid grid-cols-2 items-center">
                    <h5 class="text-sm">
                      Precio sugerido desde <b>{{ data.attributes.price_currency }} ${{ roundNumber(data.attributes.price) }}</b>
                    </h5>

                    <button @click="addReservartion" type="button" class="text-white text-[15px] font-bold bg-[#35BC75] px-3 py-3 rounded-[10px]">
                      Elegir esta opción
                    </button>
                  </div>
                </article>
              </div>
            </div>
          </div>
        </client-only>
      </div>
    </div>
  </section>
</template>

<script>
import Swiper from 'swiper/swiper-bundle.min'
import 'swiper/swiper-bundle.min.css'

export default {
  async asyncData ({ params, $axios }) {
    const res = await $axios.$get(`https://turismo.catam.ar/api/v1/producto_turistico/${params.id}`)
    const data = res.data
    return { data }
  },
  data () {
    return {
      alojamiento: null
    }
  },
  head: {
    title: 'Alojamiento'
  },
  async mounted () {
    await this.$nextTick()
    this.initializeSwiperMain()
    this.initializeSwiperImages()
    this.getAlojamiento()
  },
  methods: {
    roundNumber (number) {
      return Math.round(number)
    },
    addReservartion () {
      this.$router.push(`/reservas/resumen/?id=${this.data.id}`)
    },
    initializeSwiperMain () {
      new Swiper(this.$refs.swiper, {
        slidesPerView: 1,
        spaceBetween: 16,
        breakpoints: {
          768: {
            slidesPerView: 2,
            spaceBetween: 16
          }
        }
      })
    },
    initializeSwiperImages () {
      new Swiper(this.$refs.swiperImages, {})
    },
    getAlojamiento () {
      this.$axios.$get(`https://turismo.catam.ar/api/v1/alojamiento/${this.data.attributes.objeto.id}`)
        .then((res) => {
          this.alojamiento = res.data
        })
        .catch((err) => {
          console.log(err)
        })
    }
  }
}
</script>

<style scoped>
.swiper-slide {
  height: auto;
}
</style>
